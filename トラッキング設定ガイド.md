# データトラッキング設定ガイド

## 環境

- **メインLP**: ペライチ
- **ウェビナー・資料請求LP**: HubSpot
- **広告**: Meta、Google、LINE

---

## 1. トラッキングの全体像

### 計測するもの

```
広告 → LP訪問 → フォーム送信 → 商談 → 成約
 ↓      ↓         ↓          ↓      ↓
広告費  訪問数   リード数    商談数  売上

→ 各段階を計測し「どの広告が成果に繋がったか」を把握する
```

### 必要なツールの役割

| ツール | 役割 | 費用 |
|--------|------|------|
| **GA4 (Google Analytics 4)** | サイト全体の訪問分析 | 無料 |
| **GTM (Google Tag Manager)** | 各種タグの一元管理 | 無料 |
| **Meta Pixel** | Meta広告のコンバージョン計測 | 無料 |
| **Google Ads タグ** | Google広告のコンバージョン計測 | 無料 |
| **LINE Tag** | LINE広告のコンバージョン計測 | 無料 |
| **HubSpot** | フォーム送信・リード管理 | 無料〜 |

---

## 2. 設定手順

### ステップ一覧

```
[ステップ1] GA4アカウント作成
     ↓
[ステップ2] GTMアカウント作成
     ↓
[ステップ3] 各LPにGTMコードを設置
     ↓
[ステップ4] GTM経由でGA4を設定
     ↓
[ステップ5] 各広告プラットフォームのタグ設定
     ↓
[ステップ6] コンバージョン設定
     ↓
[ステップ7] UTMパラメータの設計
     ↓
[ステップ8] 動作確認・テスト
```

---

## 3. 各プラットフォーム別の設定方法

### A. ペライチ（メインLP）

**GTMコードの設置方法:**
1. ペライチ管理画面 → ページ編集
2. 「ページ情報編集」→「タグの設定」
3. 「headタグ」にGTMの上部コード貼り付け
4. 「bodyタグ」にGTMの下部コード貼り付け

```html
<!-- headタグに貼るコード -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-XXXXXX');</script>

<!-- bodyタグ開始直後に貼るコード -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
```

**注意:** ペライチの有料プラン（レギュラー以上）が必要

---

### B. HubSpot（ウェビナー・資料請求LP）

**HubSpotの強み:** トラッキングコードが自動で入っている

**追加設定:**
1. HubSpot管理画面 → 設定 → トラッキングコード
2. 「Google タグ マネージャー」連携を有効化
3. GTM IDを入力

**または手動でGTMを追加:**
1. 設定 → ウェブサイト → ページ
2. 「サイトのヘッダーHTML」にGTMコード追加

**HubSpotフォーム送信の計測:**
- HubSpot内で自動的にコンバージョンとして記録される
- GA4にも送りたい場合はGTM経由で設定

---

## 4. GTMでの各タグ設定

### 4-1. GA4の設定

**タグの作成:**
1. GTM → タグ → 新規
2. タグタイプ: 「Google タグ」
3. タグID: `G-XXXXXXXXXX`（GA4の測定ID）
4. トリガー: 「All Pages」

---

### 4-2. Meta Pixel（Facebook/Instagram広告用）

**Pixelの取得:**
1. Meta Business Suite → イベントマネージャ
2. データソース → ピクセル → 作成
3. Pixel IDをコピー

**GTMでの設定:**
1. タグ → 新規 → カスタムHTML
2. 以下のコードを貼り付け:

```html
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', 'あなたのPIXEL_ID');
fbq('track', 'PageView');
</script>
```

3. トリガー: All Pages

---

### 4-3. Google Ads コンバージョンタグ

**コンバージョンIDの取得:**
1. Google Ads → ツール → コンバージョン
2. 新しいコンバージョンアクション作成
3. 「ウェブサイト」→ 設定
4. コンバージョンIDとラベルをメモ

**GTMでの設定:**
1. タグ → 新規 → Google 広告のコンバージョン トラッキング
2. コンバージョンID: `AW-XXXXXXXXX`
3. コンバージョンラベル: `XXXXXXXXXXX`
4. トリガー: コンバージョン発生時（後述）

---

### 4-4. LINE Tag

**タグの取得:**
1. LINE広告マネージャー → 共有ライブラリ → LINE Tag
2. ベースコードをコピー

**GTMでの設定:**
1. タグ → 新規 → カスタムHTML
2. LINE Tagベースコードを貼り付け
3. トリガー: All Pages

---

## 5. コンバージョン設定

### コンバージョン = 成果となるアクション

| コンバージョン | 発生場所 | 計測方法 |
|---------------|---------|---------|
| 資料請求完了 | HubSpot LP | サンクスページ到達 or フォーム送信 |
| ウェビナー申込完了 | HubSpot LP | サンクスページ到達 or フォーム送信 |
| 問い合わせ完了 | ペライチ | サンクスページ到達 |

### GTMでのコンバージョントリガー設定

**方法1: サンクスページURL到達**
1. トリガー → 新規 → ページビュー
2. 条件: Page URL に「/thanks」を含む
3. このトリガーをコンバージョンタグに紐付け

**方法2: フォーム送信検知**
1. トリガー → 新規 → フォーム送信
2. 条件: Form ID = 特定のフォーム
3. このトリガーをコンバージョンタグに紐付け

---

## 6. UTMパラメータの設計

### UTMとは？
広告URLに付ける「どこから来たか」を識別するパラメータ

### 基本形式
```
https://あなたのLP.com/?utm_source=○○&utm_medium=○○&utm_campaign=○○
```

### 設計例

| 広告 | utm_source | utm_medium | utm_campaign | utm_content |
|------|-----------|-----------|--------------|-------------|
| Meta広告 | facebook | cpc | webinar_202402 | image_a |
| Google検索 | google | cpc | brand_search | headline_1 |
| Googleディスプレイ | google | display | retargeting | banner_300x250 |
| LINE広告 | line | cpc | webinar_202402 | creative_a |

### URL例
```
https://example.com/webinar?utm_source=facebook&utm_medium=cpc&utm_campaign=webinar_202402&utm_content=image_a
```

### 命名ルール（統一が重要）
- **すべて小文字**
- **スペースは使わない**（アンダースコア`_`を使用）
- **日本語は避ける**
- **ルールをドキュメント化**

---

## 7. 動作確認・テスト

### テスト手順

1. **GTMプレビューモード**
   - GTM → プレビュー → サイトURLを入力
   - タグが発火しているか確認

2. **GA4 リアルタイムレポート**
   - GA4 → レポート → リアルタイム
   - 自分のアクセスが反映されているか確認

3. **Meta Pixel Helper**（Chrome拡張）
   - Pixelが正しく発火しているか確認

4. **Google Tag Assistant**（Chrome拡張）
   - 各タグの動作確認

5. **実際にテストコンバージョン**
   - フォーム送信 → コンバージョンが記録されるか確認

---

## 8. 設定チェックリスト

- [ ] GA4アカウント作成完了
- [ ] GTMアカウント作成完了
- [ ] ペライチにGTMコード設置
- [ ] HubSpotにGTMコード設置（または連携設定）
- [ ] GTMでGA4タグ設定
- [ ] GTMでMeta Pixel設定
- [ ] GTMでGoogle Adsタグ設定
- [ ] GTMでLINE Tag設定
- [ ] コンバージョントリガー設定
- [ ] UTMパラメータルール策定
- [ ] テスト完了
- [ ] 本番公開

---

## 9. 初期設定手順（詳細）

### Step 1: GA4アカウント作成

1. https://analytics.google.com/ にアクセス
2. 「測定を開始」をクリック
3. 以下を入力:
   - **アカウント名**: 会社名やプロジェクト名
   - **プロパティ名**: サイト名（例: 「〇〇サービス」）
   - **タイムゾーン**: 日本
   - **通貨**: 日本円
4. 「ウェブ」を選択
5. **ウェブサイトのURL**: メインLPのURL
6. **ストリーム名**: 任意（例: 「メインサイト」）
7. 完了すると **測定ID**（G-XXXXXXXXXX）が発行される → **メモしておく**

### Step 2: GTMアカウント作成

1. https://tagmanager.google.com/ にアクセス
2. 「アカウントを作成」をクリック
3. 以下を入力:
   - **アカウント名**: 会社名
   - **国**: 日本
   - **コンテナ名**: サイト名
   - **ターゲットプラットフォーム**: ウェブ
4. 利用規約に同意
5. **GTMコード**（GTM-XXXXXX）が表示される → **メモしておく**

---

## 参考リンク

- [GA4公式ヘルプ](https://support.google.com/analytics)
- [GTM公式ヘルプ](https://support.google.com/tagmanager)
- [Meta Pixel設定ガイド](https://www.facebook.com/business/help/952192354843755)
- [LINE Tag設定ガイド](https://www.linebiz.com/jp/manual/line-ads/tracking_linetag/)
